{"ast":null,"code":"var _jsxFileName = \"C:\\\\Nghuytan\\\\KLTN\\\\dApp\\\\land-registry\\\\client\\\\src\\\\App.js\";\nimport React, { Component } from \"react\";\nimport axios from 'axios';\nimport Cookies from 'js-cookie';\nimport LandRegistryContract from \"./contracts/LandRegistry.json\";\nimport getWeb3 from \"./getWeb3\";\nimport Header from './components/header';\nimport Login from './components/login';\nimport SuperAdmin from './components/superadmin';\nimport Admin from './components/admin';\nimport User from './components/user';\nimport Notif from './components/notif';\nimport './App.css';\nimport logout from \"./assets/poweroff.svg\";\n\nclass App extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      storageValue: 0,\n      web3: null,\n      accounts: null,\n      contract: null,\n      who: null,\n      code: 0\n    };\n\n    this.componentDidMount = async () => {\n      try {\n        const web3 = await getWeb3();\n        const accounts = await web3.eth.getAccounts(); // Get the contract instance.\n\n        const networkId = await web3.eth.net.getId();\n        const deployedNetwork = LandRegistryContract.networks[networkId];\n        const instance = new web3.eth.Contract(LandRegistryContract.abi, deployedNetwork && deployedNetwork.address);\n        this.setState({\n          web3,\n          accounts,\n          contract: instance\n        });\n\n        if (Cookies.get(\"la57L0663D\") && Cookies.get(\"la57L0663D\") === this.state.accounts[0].toLowerCase()) {\n          this.login();\n        }\n      } catch (error) {\n        alert(\"Failed to load web3, accounts, or contract. Check console for details.\");\n        console.error(error);\n      }\n    };\n\n    this.addAdminBC = async adminAddress => {\n      const _this$state = this.state,\n            accounts = _this$state.accounts,\n            contract = _this$state.contract;\n      console.log(adminAddress, accounts[0]);\n      await contract.methods.addAdmin(adminAddress).send({\n        from: accounts[0]\n      });\n    };\n\n    this.createPropertyBC = async (surveynumber, ownerAddress, marketValue, landType, citytown, district, state) => {\n      const _this$state2 = this.state,\n            accounts = _this$state2.accounts,\n            contract = _this$state2.contract;\n      await contract.methods.createProperty(surveynumber, ownerAddress, marketValue, landType, citytown, district, state).send({\n        from: accounts[0]\n      });\n    };\n\n    this.propertyEnquiryBC = async surveynumber => {\n      const _this$state3 = this.state,\n            accounts = _this$state3.accounts,\n            contract = _this$state3.contract;\n      return await contract.methods.getPropertyDetails(surveynumber).call({\n        from: accounts[0]\n      });\n    };\n\n    this.updateUserInfo = obj => {\n      this.setState({\n        userinfo: obj\n      });\n    };\n\n    this.logout = () => {\n      Cookies.remove(\"la57L0663D\");\n      this.setState({\n        who: null,\n        code: 10\n      });\n      setTimeout(function () {\n        this.setState({\n          code: 0\n        });\n      }.bind(this), 2000);\n    };\n\n    this.login = () => {\n      console.log('Checking if SuperAdmin...');\n\n      if (this.state.accounts[0].toLowerCase() === \"0x86f5b06Da8C345205546588f923551A996de1959\".toLowerCase()) {\n        //\"superAdmin address from Ganache\" -> truffle migrate will be get that address, after that upload on Migration.sol\n        console.log(\"Welcome Lord!\");\n        this.setState({\n          who: 'superadmin',\n          code: 1\n        });\n      } else {\n        console.log('Checking if admin...');\n        axios.get('http://localhost:5000/api/admin/' + this.state.accounts[0].toLowerCase()).then(res => {\n          if (res.data) {\n            this.setState({\n              who: 'admin',\n              userinfo: {\n                name: res.data.name,\n                aadhaar: res.data.aadhaar,\n                citytown: res.data.citytown,\n                district: res.data.district,\n                state: res.data.state\n              },\n              code: 2\n            });\n          } else {\n            console.log('Checking if existing user...');\n            axios.get('http://localhost:5000/api/user/' + this.state.accounts[0].toLowerCase()).then(res => {\n              if (res.data) {\n                this.setState({\n                  who: 'user',\n                  userinfo: res.data,\n                  code: 3\n                });\n              } else {\n                console.log('Creating user...');\n                axios.post('http://localhost:5000/api/user/add', {\n                  address: this.state.accounts[0].toLowerCase()\n                }).then(res => {\n                  this.setState({\n                    who: 'user',\n                    userinfo: res.data,\n                    code: 4\n                  });\n                }).catch(error => {\n                  console.log(error, \"Try again!\");\n                });\n              }\n            }).catch(error => {\n              console.log(error, \"Try again!\");\n            });\n          }\n        }).catch(error => {\n          console.log(error, \"Try again!\");\n        });\n      }\n\n      Cookies.set(\"la57L0663D\", this.state.accounts[0].toLowerCase());\n      setTimeout(function () {\n        this.setState({\n          code: 0\n        });\n      }.bind(this), 2000);\n    };\n\n    this.componentDidUpdate = () => {\n      const ethereum = window.ethereum;\n\n      if (ethereum) {\n        // Listening to Event\n        ethereum.on('accountsChanged', accounts => {\n          //Useful when the account is changed in between\n          let loggedin = this.state.who !== null;\n          this.setState({\n            accounts,\n            who: null,\n            code: 5\n          });\n          setTimeout(function () {\n            if (loggedin) {\n              this.login();\n            } else {\n              this.setState({\n                code: 0\n              });\n              return;\n            }\n\n            ;\n          }.bind(this), 1500);\n        });\n      }\n    };\n\n    this.codeChanger = x => {\n      this.setState({\n        code: x\n      });\n      setTimeout(function () {\n        this.setState({\n          code: 0\n        });\n      }.bind(this), 2000);\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, React.createElement(Header, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }), React.createElement(Notif, {\n      code: this.state.code,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"components\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    }, !this.state.who && React.createElement(Login, {\n      login: this.login,\n      quickCheck: this.propertyEnquiryBC,\n      codeChanger: this.codeChanger,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }), this.state.who === 'admin' && React.createElement(Admin, {\n      address: this.state.accounts[0].toLowerCase(),\n      userinfo: this.state.userinfo,\n      codeChanger: this.codeChanger,\n      createProp: this.createPropertyBC,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150\n      },\n      __self: this\n    }), this.state.who === 'superadmin' && React.createElement(SuperAdmin, {\n      address: this.state.accounts[0].toLowerCase(),\n      codeChanger: this.codeChanger,\n      addAdmin: this.addAdminBC,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }), this.state.who === 'user' && React.createElement(User, {\n      userinfo: this.state.userinfo,\n      updateUserInfo: this.updateUserInfo,\n      address: this.state.accounts[0].toLowerCase(),\n      accounts: this.state.accounts,\n      contract: this.state.contract,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    })), this.state.who && React.createElement(\"div\", {\n      className: \"logout\",\n      onClick: () => this.logout(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: logout,\n      alt: \"MetaMask\",\n      className: \"Log Out\",\n      height: 20,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Nghuytan/KLTN/dApp/land-registry/client/src/App.js"],"names":["React","Component","axios","Cookies","LandRegistryContract","getWeb3","Header","Login","SuperAdmin","Admin","User","Notif","App","state","storageValue","web3","accounts","contract","who","code","componentDidMount","eth","getAccounts","networkId","net","getId","deployedNetwork","networks","instance","Contract","abi","address","setState","get","toLowerCase","login","error","alert","console","addAdminBC","adminAddress","log","methods","addAdmin","send","from","createPropertyBC","surveynumber","ownerAddress","marketValue","landType","citytown","district","createProperty","propertyEnquiryBC","getPropertyDetails","call","updateUserInfo","obj","userinfo","logout","remove","setTimeout","bind","then","res","data","name","aadhaar","post","catch","set","componentDidUpdate","ethereum","window","on","loggedin","codeChanger","x","render"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport axios from 'axios';\r\nimport Cookies from 'js-cookie';\r\nimport LandRegistryContract from \"./contracts/LandRegistry.json\";\r\nimport getWeb3 from \"./getWeb3\";\r\nimport Header from './components/header'\r\nimport Login from './components/login'\r\nimport SuperAdmin from './components/superadmin'\r\nimport Admin from './components/admin'\r\nimport User from './components/user'\r\nimport Notif from './components/notif'\r\n\r\nimport './App.css';\r\nimport logout from './assets/poweroff.svg';\r\n\r\nclass App extends Component {\r\n  state = { storageValue: 0, web3: null, accounts: null, contract: null, who: null, code: 0 };\r\n\r\n  componentDidMount = async () => {\r\n    try {\r\n      const web3 = await getWeb3();\r\n      const accounts = await web3.eth.getAccounts();\r\n\r\n      // Get the contract instance.\r\n      const networkId = await web3.eth.net.getId();\r\n      const deployedNetwork = LandRegistryContract.networks[networkId];\r\n      const instance = new web3.eth.Contract(\r\n        LandRegistryContract.abi,\r\n        deployedNetwork && deployedNetwork.address,\r\n      );\r\n\r\n      this.setState({ web3, accounts, contract: instance });\r\n      if (Cookies.get(\"la57L0663D\") && Cookies.get(\"la57L0663D\") === this.state.accounts[0].toLowerCase()) {\r\n        this.login()\r\n      }\r\n    } catch (error) {\r\n      alert(`Failed to load web3, accounts, or contract. Check console for details.`,);\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  //Smart Contract\r\n  //Admin\r\n  addAdminBC = async (adminAddress) => {\r\n    const { accounts, contract } = this.state;\r\n    console.log(adminAddress, accounts[0]);\r\n    await contract.methods.addAdmin(adminAddress).send({ from: accounts[0] });\r\n  }\r\n\r\n  createPropertyBC = async (surveynumber, ownerAddress, marketValue, landType, citytown, district, state) => {\r\n    const { accounts, contract } = this.state;\r\n    await contract.methods.createProperty(surveynumber, ownerAddress, marketValue, landType, citytown, district, state).send({ from: accounts[0] })\r\n  }\r\n\r\n  propertyEnquiryBC = async (surveynumber) => {\r\n    const { accounts, contract } = this.state;\r\n    return await contract.methods.getPropertyDetails(surveynumber).call({ from: accounts[0] });\r\n  }\r\n\r\n  updateUserInfo = (obj) => {\r\n    this.setState({ userinfo: obj })\r\n  }\r\n\r\n  logout = () => {\r\n    Cookies.remove(\"la57L0663D\");\r\n    this.setState({ who: null, code: 10 })\r\n    setTimeout(function () {\r\n      this.setState({ code: 0 });\r\n    }.bind(this), 2000);\r\n  }\r\n\r\n  login = () => {\r\n    console.log('Checking if SuperAdmin...')\r\n    if (this.state.accounts[0].toLowerCase() === \"0x86f5b06Da8C345205546588f923551A996de1959\".toLowerCase()) {\r\n      //\"superAdmin address from Ganache\" -> truffle migrate will be get that address, after that upload on Migration.sol\r\n      console.log(\"Welcome Lord!\");\r\n      this.setState({ who: 'superadmin', code: 1 })\r\n    } else {\r\n      console.log('Checking if admin...')\r\n      axios.get('http://localhost:5000/api/admin/' + this.state.accounts[0].toLowerCase())\r\n        .then(res => {\r\n          if (res.data) {\r\n            this.setState({ who: 'admin', userinfo: { name: res.data.name, aadhaar: res.data.aadhaar, citytown: res.data.citytown, district: res.data.district, state: res.data.state }, code: 2 })\r\n          } else {\r\n            console.log('Checking if existing user...')\r\n            axios.get('http://localhost:5000/api/user/' + this.state.accounts[0].toLowerCase())\r\n              .then(res => {\r\n                if (res.data) {\r\n                  this.setState({ who: 'user', userinfo: res.data, code: 3 })\r\n                } else {\r\n                  console.log('Creating user...')\r\n                  axios.post('http://localhost:5000/api/user/add', { address: this.state.accounts[0].toLowerCase() })\r\n                    .then(res => {\r\n                      this.setState({ who: 'user', userinfo: res.data, code: 4 })\r\n                    })\r\n                    .catch((error) => {\r\n                      console.log(error, \"Try again!\")\r\n                    });\r\n                }\r\n              })\r\n              .catch((error) => {\r\n                console.log(error, \"Try again!\")\r\n              });\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.log(error, \"Try again!\")\r\n        });\r\n    }\r\n    Cookies.set(\"la57L0663D\", this.state.accounts[0].toLowerCase());\r\n    setTimeout(function () {\r\n      this.setState({ code: 0 });\r\n    }.bind(this), 2000);\r\n  }\r\n\r\n  componentDidUpdate = () => {\r\n    const ethereum = window.ethereum\r\n    if (ethereum) {\r\n      // Listening to Event\r\n      ethereum.on('accountsChanged', accounts => { //Useful when the account is changed in between\r\n        let loggedin = (this.state.who !== null)\r\n        this.setState({ accounts, who: null, code: 5 })\r\n        setTimeout(function () {\r\n          if (loggedin) {\r\n            this.login()\r\n          } else {\r\n            this.setState({ code: 0 })\r\n            return\r\n          };\r\n        }.bind(this), 1500);\r\n      })\r\n    }\r\n  }\r\n\r\n  codeChanger = (x) => {\r\n    this.setState({ code: x })\r\n    setTimeout(function () {\r\n      this.setState({ code: 0 });\r\n    }.bind(this), 2000);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"App\">\r\n        <div className=\"main\">\r\n          <Header />\r\n          <Notif code={this.state.code} />\r\n          <div className=\"components\">\r\n            {!this.state.who && <Login login={this.login} quickCheck={this.propertyEnquiryBC} codeChanger={this.codeChanger} />}\r\n            {this.state.who === 'admin' && <Admin address={this.state.accounts[0].toLowerCase()} userinfo={this.state.userinfo} codeChanger={this.codeChanger} createProp={this.createPropertyBC} />}\r\n            {this.state.who === 'superadmin' && <SuperAdmin address={this.state.accounts[0].toLowerCase()} codeChanger={this.codeChanger} addAdmin={this.addAdminBC} />}\r\n            {this.state.who === 'user' && <User userinfo={this.state.userinfo} updateUserInfo={this.updateUserInfo} address={this.state.accounts[0].toLowerCase()} accounts={this.state.accounts} contract={this.state.contract} />}\r\n          </div>\r\n          {this.state.who && <div className=\"logout\" onClick={() => this.logout()}><img src={logout} alt=\"MetaMask\" className=\"Log Out\" height={20} /></div>}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}